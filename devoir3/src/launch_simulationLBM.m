% MATLAB script to launch a fiber structure generation and the corresponding LBM simulation
%
%INPUT VARIABLES:
%
% SEED: integer representing the seed for initializing the random
% generator. If seed=0, automatic seed generation. If you want to reproduce
% the same fiber structure, use the same seed (fibers will be located at the same place). 
%
% MEAN_D: contains the mean fiber to be used
%
% STD_D: contains the standard deviation of the fiber diameters
%
% PORO: estimated porosity of the fiber structure to be generated
% 
% NX: domain lateral size in grid cell

seed=0;
deltaP= 0.10 ; % pressure drop in Pa
NX= 200 ;
%poro= 0.91 ;
mean_fiber_d= 12.5 ; % in microns
std_d= 2.85 ; % in microns
dx = 2e-6*100./NX;
filename= 'fiber_mat.tiff' ;



% calculation of the flow field and the permeability from Darcy Law
% multiPoro=[0.893284   0.90290177 0.89616896 0.89114526 0.89978863 0.90321249 0.90049888 0.90226854 0.89524258 0.89727944 0.89495655 0.89730335 0.8939014  0.88705288 0.9013307  0.89698664 0.88777351 0.90347087 0.89319526 0.90038959 0.90546818 0.90096737 0.90854551 0.89073881 0.90301756 0.89486392 0.89346902 0.89565863 0.89766336 0.90042124 0.89126138 0.9067562  0.90349247 0.88847817 0.91116189 0.91421917 0.90884085 0.89865056 0.89196936 0.90790839 0.89697617 0.90916834 0.90156206 0.90732479 0.90267275 0.9052993  0.90007875 0.91339403 0.90095184 0.90301492 0.91412363 0.88989181 0.89047136 0.90727048 0.89120157 0.91457716 0.89689786 0.89439409 0.91442207 0.91110386 0.91400669 0.90679533 0.89354081 0.91432549 0.89798997 0.90601842 0.90710439 0.89883742 0.9046056  0.90691655 0.90282319 0.89175449 0.90223679 0.90994789 0.89479074 0.89887774 0.89673635 0.91386948 0.90504221 0.90305596 0.89422563 0.90404437 0.89494251 0.90023873 0.89523115 0.90507325 0.90432443 0.89843776 0.90297005 0.89180204 0.88881557 0.90329544 0.90125005 0.90476274 0.91787359 0.9070836 0.89315383 0.90837762 0.89013069 0.89653812];

multiPoro_10=[0.89548719 0.89589627 0.90457238 0.90569199 0.89110561 0.9069705  0.90410214 0.89347806 0.90917571 0.89900677];
multiPoro_100=[0.89621328 0.89666432 0.90282852 0.8952217  0.89921435 0.89886718  0.9063347  0.90681482 0.90736816 0.89114287 0.90067458 0.89470316 0.90039169 0.88993816 0.91037207 0.90290185 0.8900066  0.90377863  0.90774687 0.89908332 0.91374478 0.899507   0.91397833 0.89907232 0.90915299 0.89995059 0.90445309 0.89502016 0.89544433 0.88826722  0.88699694 0.89538327 0.89284025 0.89813396 0.89958684 0.90211552 0.88579261 0.90628733 0.89687766 0.91017696 0.89101755 0.88742216 0.90758425 0.89453904 0.89837074 0.90397513 0.88578035 0.90243514  0.89754244 0.90377301 0.90754162 0.90431014 0.9116751  0.89685811 0.89692712 0.90837281 0.89811766 0.89688579 0.89520685 0.91873326 0.87746154 0.89344502 0.88012358 0.90843004 0.89839772 0.90848874 0.90027925 0.90977063 0.90187425 0.89515599 0.90353397 0.89701423 0.89280589 0.90405655 0.89941316 0.91375345 0.9076852  0.89938749 0.88029342 0.89732657 0.89926048 0.89024703 0.90216555 0.91088533 0.89866561 0.8987257  0.90412595 0.91572211 0.89342398 0.89675256 0.89365576 0.901228   0.90223799 0.90178252 0.89883146 0.89355366 0.91896759 0.89366636 0.90667997 0.90579003];
multiPoro_1000=[0.904879   0.90177612 0.90538507 0.90962174 0.88571521 0.91183475 0.89176882 0.90520368 0.89501738 0.88732902 0.91238326 0.9004795 0.90674513 0.89110544 0.89339683 0.8954343  0.90285818 0.88870993 0.89456808 0.89664256 0.90562085 0.89143852 0.90238602 0.89277662 0.90620916 0.9009131  0.90640794 0.90433229 0.90870453 0.89807378 0.89797146 0.90775448 0.89723702 0.90194728 0.89381124 0.89646368 0.8884389  0.90571841 0.90141869 0.90086471 0.91344504 0.89200715 0.8933694  0.8996559  0.90668998 0.90646001 0.89649493 0.9077732 0.8980085  0.88921454 0.90586824 0.90670228 0.90749937 0.90105211 0.9017529  0.90204893 0.896534   0.91335579 0.89225504 0.90715822 0.91133396 0.89269908 0.89756673 0.91121321 0.91358689 0.90716784 0.90244622 0.90999756 0.9021915  0.90928757 0.90824099 0.89557637 0.90676471 0.90121899 0.89370356 0.89609133 0.88765647 0.89692124 0.90611545 0.89959501 0.91682739 0.90137233 0.89163566 0.89189216 0.88854506 0.91101304 0.89833875 0.89538095 0.90743538 0.90465057 0.91036152 0.90833301 0.89731279 0.91091961 0.89646229 0.88766354 0.90304262 0.89585916 0.89093047 0.92059732 0.91016808 0.88317085 0.89963523 0.90431624 0.90729507 0.90521256 0.89335497 0.90433898 0.90068097 0.90215437 0.89544736 0.89513619 0.89673965 0.89434785 0.9022859  0.90914259 0.89884153 0.88001858 0.90736074 0.88876428 0.90130264 0.89511785 0.89781483 0.8944133  0.89573557 0.8973753 0.90389045 0.89719288 0.90092477 0.89099043 0.90772541 0.90341125 0.91554856 0.88429144 0.90207115 0.9047444  0.91693541 0.90675139 0.89976898 0.90646443 0.88622988 0.9064032  0.89660668 0.90061054 0.90434969 0.90785428 0.89887218 0.90841009 0.91052284 0.89486018 0.89797905 0.88909649 0.90652645 0.88814229 0.90426639 0.89840309 0.89688899 0.88447949 0.90410371 0.89760547 0.90762187 0.89253073 0.8951981  0.89028814 0.90537886 0.92008577 0.89061072 0.90116719 0.90403555 0.89465369 0.89737609 0.90013819 0.90920619 0.90325218 0.90742591 0.90337031 0.89513441 0.89866096 0.90020219 0.9039112 0.90476102 0.89794063 0.89723688 0.90245699 0.91643227 0.89812667 0.89688812 0.89730429 0.89933616 0.90153079 0.9093811  0.89345339 0.91023973 0.90075403 0.90273555 0.90811806 0.88481298 0.90875235 0.90627415 0.89938671 0.90428772 0.89798148 0.89952294 0.90909371 0.89806538 0.90858612 0.90414161 0.88578712 0.89544832 0.88700623 0.89873394 0.89093986 0.90554358 0.89353156 0.89514699 0.89844797 0.91322602 0.89449872 0.88869583 0.89635882 0.89504522 0.90115875 0.89645115 0.90526154 0.89911918 0.88675771 0.91040169 0.8957885 0.90362323 0.9012324  0.90065365 0.90471629 0.90740276 0.89153137 0.88600528 0.89774202 0.90427293 0.89762525 0.89926018 0.89643893 0.9079389  0.90002947 0.90394192 0.88921014 0.89636274 0.9032356 0.89785494 0.88984263 0.90553432 0.89150588 0.88972605 0.90888212 0.89901004 0.90375279 0.89343678 0.89917897 0.90257431 0.9021214 0.89831677 0.88635043 0.90626119 0.91699267 0.91196755 0.89861863 0.89133134 0.9060936  0.88629229 0.89918326 0.89488319 0.90994825 0.90870437 0.89723082 0.90352076 0.90175117 0.90419273 0.89778414 0.90718483 0.90543693 0.88181786 0.90084893 0.90655631 0.90753371 0.90582432 0.89019743 0.90016753 0.89301063 0.89757838 0.90103364 0.89864072 0.89813379 0.90067633 0.90633265 0.90465473 0.89588045 0.89600073 0.89323334 0.90666343 0.90136889 0.89913636 0.911498 0.90665501 0.90037443 0.89661767 0.89882764 0.89334184 0.91322455 0.90649455 0.90400587 0.88951681 0.90525296 0.90319483 0.9019847 0.9093215  0.91203199 0.89282898 0.90695387 0.90236325 0.89967368 0.89463212 0.8886822  0.89925627 0.89656257 0.90796567 0.90365355 0.89486102 0.8968346  0.89156734 0.89142895 0.89650013 0.89521571 0.89300878 0.89525853 0.89246658 0.90191151 0.89749953 0.8963664 0.9115586  0.88212151 0.91197873 0.90610969 0.91905707 0.88912763 0.91162109 0.89107005 0.89415057 0.89631087 0.89595315 0.89413214 0.91734025 0.89880221 0.89364353 0.90407299 0.89109405 0.89557621 0.90227332 0.90057109 0.90981351 0.90474477 0.90696993 0.88905638 0.90496075 0.90228293 0.89517925 0.89611508 0.90149813 0.90904933 0.89311414 0.89767653 0.89883844 0.90321847 0.89656833 0.90106699 0.90551048 0.91270326 0.88371269 0.90928337 0.89709655 0.90085683 0.88733682 0.90284746 0.89672467 0.90033531 0.89546832 0.91058511 0.88713473 0.89783978 0.90486967 0.89392545 0.90194259 0.89314378 0.89610136 0.89905149 0.90815454 0.8966484  0.90432392 0.89421714 0.92173629 0.90614964 0.89484336 0.8897223  0.89390273 0.89126371 0.911728   0.8966211  0.89657026 0.89621002 0.90315985 0.90111583 0.90243779 0.89883254 0.90476681 0.895691   0.88935709 0.90964908 0.90092447 0.90108439 0.89747636 0.90510692 0.90388568 0.89089688 0.90933358 0.89049964 0.88299643 0.89259733 0.89581296 0.90087918 0.8927236  0.89708185 0.89992566 0.90735338 0.8995212  0.91444929 0.91042463 0.90090113 0.88496756 0.89913904 0.89295627 0.90013263 0.90936571 0.90250119 0.91190599 0.896764   0.90445332 0.90342356 0.89623354 0.89939461 0.90933616 0.89880045 0.90225501 0.89146241 0.9041953  0.89758634 0.8982457  0.90398517 0.90843067 0.90987006 0.9020068  0.89226589 0.90395304 0.88942596 0.90708087 0.9051131 0.89485269 0.89896346 0.89298976 0.89898814 0.91484405 0.899282 0.90275198 0.89916415 0.89565107 0.90164245 0.89871482 0.90669999 0.9126319  0.90739474 0.9059699  0.88330266 0.91963367 0.9026614  0.90728863 0.91216099 0.89642829 0.90634345 0.89496357 0.88797089 0.9104908  0.90151793 0.89065766 0.89605145 0.8832251  0.90060855 0.90596626 0.89184594 0.90983508 0.89406244 0.88532568 0.89722275 0.89168249 0.90888092 0.90327987 0.89836897 0.91074756 0.8997967 0.88636778 0.89957805 0.90448526 0.90058325 0.90267687 0.90916878 0.90150027 0.89807774 0.89506849 0.90939833 0.90046116 0.9043088 0.89137018 0.89753881 0.90604615 0.89081279 0.89930427 0.90893871 0.90014818 0.89313476 0.88850273 0.90633863 0.89637548 0.89345677 0.89763355 0.90253561 0.90329352 0.89156711 0.90698398 0.90372293 0.88438273 0.89845638 0.91272214 0.89985162 0.91835548 0.90429672 0.89316376 0.90048003 0.8944806  0.89979014 0.89389646 0.87980853 0.89776952 0.88869733 0.89241868 0.90576792 0.90288567 0.90396185 0.89921272 0.89642051 0.90467591 0.89367976 0.90630494 0.90015171 0.90279468 0.89329644 0.90578524 0.894128   0.91087578 0.88888332 0.88987862 0.90630006 0.91122497 0.91262888 0.90279122 0.90531449 0.89225671 0.89781756 0.89357419 0.89754908 0.90757798 0.91338546 0.90076571 0.91310026 0.90154179 0.91304682 0.89013787 0.888156 0.90841442 0.90043456 0.90413457 0.8862325  0.90618511 0.9065433 0.90429653 0.89749006 0.90108983 0.89498896 0.8893974  0.90505814 0.89674828 0.90627456 0.90386722 0.89483596 0.89048353 0.8979171 0.90095867 0.89116294 0.89200908 0.90128503 0.90922001 0.8855727 0.90204861 0.89443542 0.88871819 0.91119742 0.91207426 0.91250268 0.89363503 0.90464779 0.88521775 0.90451377 0.89885601 0.90079976 0.89520334 0.89905831 0.89088477 0.89384523 0.89629125 0.89761853 0.90725868 0.90644845 0.89841498 0.88690592 0.90733763 0.89608634 0.89525198 0.90679542 0.91540579 0.89826579 0.88717542 0.90316065 0.90549362 0.89250781 0.89454526 0.91444989 0.90724626 0.8922591 0.90267062 0.89622606 0.90036363 0.8939082  0.8822827  0.89229554 0.89165576 0.91883484 0.90763093 0.9009569  0.9057525  0.91170688 0.89252622 0.89988097 0.89982385 0.89615179 0.90857515 0.89399032 0.88688992 0.90585584 0.88841976 0.89733942 0.90231373 0.90449271 0.89561156 0.90667852 0.88759775 0.90418059 0.90672261 0.89824696 0.90242701 0.90366895 0.89724423 0.89601328 0.90128554 0.90406504 0.90193865 0.90585586 0.89671425 0.89659492 0.88965958 0.88458844 0.88639029 0.8913533  0.91309575 0.90361581 0.90398144 0.89597233 0.9035578  0.90255531 0.90031323 0.90311209 0.89884221 0.90591541 0.90339443 0.89379983 0.89172782 0.89121184 0.89657869 0.89760836 0.90539182 0.91107755 0.89092085 0.89813309 0.88797294 0.89196913 0.90601215 0.90765442 0.89954425 0.90320718 0.88971643 0.886222 0.90488948 0.90346763 0.8965278  0.90156853 0.88697482 0.90141661 0.89731901 0.89783166 0.88954662 0.90385819 0.90327427 0.91404933 0.9030027  0.90412723 0.90894279 0.89954391 0.89344987 0.8940568 0.8957722  0.9038057  0.90944059 0.90359928 0.89728569 0.89907498 0.91605658 0.90479507 0.89981622 0.91433163 0.89397349 0.91057638 0.89789578 0.8998113  0.90240566 0.89585923 0.90493309 0.91585007 0.90765335 0.89333344 0.88453555 0.90281425 0.90798446 0.90131877 0.89775152 0.90647443 0.90769361 0.89867248 0.89733662 0.89238 0.89499384 0.90355603 0.89966034 0.90469881 0.89625194 0.89732204 0.89620988 0.89744081 0.89033028 0.90715001 0.8941951  0.90838807 0.91384358 0.90343221 0.90677269 0.90566363 0.90123771 0.89432737 0.90816749 0.89957312 0.88931497 0.90711582 0.90007308 0.89778393 0.91817223 0.90850777 0.89682253 0.89809002 0.89130571 0.90920967 0.89509629 0.90096851 0.89941312 0.90128102 0.90455241 0.89997852 0.90471691 0.89756476 0.90870769 0.89811695 0.89282606 0.89376126 0.9073054  0.90788025 0.88418915 0.91077324 0.8939766  0.90787961 0.90476531 0.9051098  0.89280246 0.89802816 0.90118279 0.89794959 0.90070911 0.89788166 0.90192227 0.90573203 0.89257718 0.89851987 0.88998975 0.91328011 0.90542518 0.87951355 0.8992434  0.89478538 0.89175938 0.91256327 0.90951652 0.89637972 0.90308811 0.89986889 0.89365334 0.89288823 0.90696429 0.90953217 0.90935841 0.89075607 0.89358299 0.90563151 0.9077759  0.89341277 0.8903163  0.90875753 0.90690911 0.91850755 0.8970948  0.89662825 0.91463621 0.90078676 0.90189659 0.90458413 0.89290961 0.89406587 0.89195973 0.89659444 0.90306606 0.89340757 0.90955944 0.90471554 0.89929162 0.90037588 0.89928148 0.89649278 0.90823933 0.90822875 0.90292098 0.89513177 0.90576595 0.89227218 0.89597279 0.89235779 0.89961076 0.91058072 0.91023215 0.91658258 0.90401179 0.90152027 0.8984239  0.89548116 0.89984166 0.90197975 0.89046813 0.89997606 0.90527203 0.89793222 0.89576749 0.90633742 0.89612806 0.89848741 0.89287196 0.90180488 0.90330441 0.90060751 0.90790987 0.89246698 0.89134079 0.90175133 0.90632249 0.90177368 0.90677122 0.89624052 0.91033383 0.90534196 0.89256048 0.90857511 0.90075127 0.89490301 0.90313563 0.89522084 0.89156876 0.88942161 0.90440527 0.90575414 0.90702927 0.90449963 0.89155133 0.89676133 0.89434614 0.91664428 0.89984522 0.90004491 0.90103723 0.89896545 0.89101205 0.90196353 0.89754259 0.90546565 0.90725381 0.89418278 0.88368324 0.90219353 0.8920143  0.90280304 0.89996536 0.90374038 0.8966617  0.90329571 0.89623348 0.90319181 0.90179065 0.89774962 0.88774449 0.90867497 0.90435948 0.89277358 0.90387872 0.88581595 0.89661924 0.9084616  0.89418355 0.8986508 0.89971469 0.88883461 0.89306487 0.91490595 0.89974923 0.89728274 0.89695547 0.899129   0.9126702  0.9022806  0.89525576 0.91243165 0.89629792 0.88855664 0.90201084 0.90359787 0.88724974 0.91338454 0.89432413 0.89998561 0.90198952 0.88731184 0.88440821 0.89889588 0.90266724 0.89818736 0.89708291 0.89251385 0.90421194 0.88949223 0.90102222 0.89996075 0.90745558 0.8986238  0.90054023 0.88729298 0.89220353 0.90054136 0.89434452 0.89888227 0.89464916 0.90147973 0.90164226 0.9002585  0.91126609 0.91372496];
multiPoro=multiPoro_1000;
N = length(multiPoro);

sol=zeros(N,1);
for i = 1 : N
  disp([i, multiPoro(i)]);
  [d_equivalent]=Generate_sample(seed,filename,mean_fiber_d,std_d,multiPoro(i),NX,dx);
  sol(i)= LBM(filename,NX,deltaP,dx,d_equivalent,1);
end
sprintf(string('%s'), strip(sprintf(string('%d,'), multiPoro), string(',')))
sprintf(string('%s'), strip(sprintf(string('%d,'), sol), string(',')))
